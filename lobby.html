<!DOCTYPE html>
<html lang="en">
  <include-header />
  <body x-data="lobby">
    <!-- <section
    x-data="ui"
    :class="(inGame && targetMode.enabled) && `target-mode-section target-mode-section-${targetMode.cursor || targetMode.type}`"
  >
    <header> -->

    Player ID: <span x-text="playerId"></span>
    <input x-model="playerName" placeholder="Player Name" />
    <button @click="savePlayerName()">Save</button>

    <br />
    Lobbies:
    <ul>
      <template x-for="currentLobby in lobbies">
        <li>
          <span x-text="currentLobby.title"></span>
          Players: <span x-text="currentLobby.players"></span>
          <template x-if="currentLobby.hasPassword && currentLobby.showPasswordEntry">
            <input
              x-init="$el.focus()"
              type="password"
              placeholder="Lobby requires a password"
              x-model="enteredPassword"
              @keyup.enter="joinLobby(currentLobby)"
            />
          </template>
          <button
            @click="joinLobby(currentLobby)"
            :disabled="currentLobby.players.length >= 2"
          >
            Join
          </button>
        </li>
      </template>
    </ul>

    Joined: <span x-text="joinedId"></span>
    <template x-if="joinedId && getJoinedLobby()">
      <div class="panel">
        You are in a game lobby for <span x-text="getJoinedLobby().gameId"></span>
        <br />
        Your opponent is <span x-text="getOpponentName()"></span>
        <template x-if="!readying">
          <label style="font-size: 48px">
            <input type="checkbox" @click="markReady($el)">
            I'm Ready
          </label>
        </template>
        <template x-if="readying">
          <div>
            <span x-text="`You will be going ${isFirst ? 'FIRST' : 'SECOND'}`"></span>
            <br />
            <span x-text="`Game starting in ${countdownSeconds}...`"></span>
          </div>
        </template>
      </div>
    </template>

    <!--
      Lobby system
      - What to do with an idle opponent? Timeout to kick or leave game?
      - Rejoining games on crash? Maybe keep current playerId or hidden key in local storage, then can check if joining a game that had a leaver/crash/timeout?
      - Handle page refresh while an action (such as target mode) is in progress
  
      Proper start of game - decide who goes first, and begin turn back and forth, win/loss screen (plus draw/tie)
      - When both players are present, have a "mark ready" (...or likely do automatically when both have chosen camps)
      - Then flip a coin to decide who goes first
      - REMEMBER: First turn for first player only get 1 water
      - Could also trim up the choosing player 1 or player 2 and just have a "join game" generically (that puts you in the next available slot), now that the logic is more fleshed out
  
      Implementation details:
      lobby.html page, server maintains a list (in memory for now, Redis/CouchDB/LowDB eventually) of Games (gameId, title, password, observers, timeLimit) that are rendered into a Lobby List on the page
      1. To start auto-add a plain game and focus on getting joining/gamestate/etc. working
      2. Make "create game" UI
      Can click join to hop into a middle step of a waiting lobby, when both ready there launch to game.html
      For now ignore auto_player and need 2 actual browsers
  
      So existing Websocket approach should "just work" once we tweak the gameId generation and setting
      What WILL be a problem is the gamestate which needs to be brought up another level - also everything in sub-files needs to be moved up, such as actions.undoStack (likely put INSIDE actions like we do with utils.universal)
      -->

    <!-- JS scripts at the bottom like it's 1995 -->
    <script src="./clientjs/lobby.js"></script>
  </body>
</html>
