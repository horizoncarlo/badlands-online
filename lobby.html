<!DOCTYPE html>
<html lang="en">
  <include-header />
  <body x-data="lobby">
    Player ID: <span x-text="playerId"></span>
    <!-- TTODO Changing name after joining a lobby is a bit jank - name doesn't update, you list your old name as your opponent, etc. -->
    <input x-model="playerName" placeholder="Player Name" />
    <button @click="savePlayerName()">Save</button>

    <br />
    Lobbies:
    <ul>
      <template x-for="currentLobby in lobbies">
        <li>
          <span x-text="currentLobby.title"></span>
          - Players: <span x-text="currentLobby.players"></span>
          <template x-if="currentLobby.hasPassword && currentLobby.showPasswordEntry">
            <input
              x-init="$el.focus()"
              type="password"
              placeholder="Lobby requires a password"
              x-model="enteredPassword"
              @keyup.enter="clickLobby(currentLobby)"
            />
          </template>
          <template x-if="!readying">
            <button
              @click="clickLobby(currentLobby)"
              :disabled="!isInLobby(currentLobby) && currentLobby.players.length >= 2"
            >
              <span x-text="!isInLobby(currentLobby) ? 'Join' : 'Leave'"></span>
            </button>
          </template>
          <template x-if="currentLobby.hasPassword && currentLobby.showPasswordEntry">
            <button @click="currentLobby.showPasswordEntry = false" class="danger">Cancel</button>
          </template>
        </li>
      </template>
    </ul>

    <template x-if="joinedId && getJoinedLobby()">
      <div class="panel">
        You are in a game lobby for <span x-text="getJoinedLobby().gameId"></span>
        <br />
        Your opponent is <span x-text="getOpponentName()"></span>
        <template x-if="!readying">
          <label style="font-size: 48px">
            <input type="checkbox" @click="markReady($el)">
            I'm Ready
          </label>
        </template>
        <template x-if="readying">
          <div>
            <span x-text="`You will be going ${isFirst ? 'FIRST' : 'SECOND'}`"></span>
            <br />
            <span x-text="`Game starting in ${countdownSeconds}...`"></span>
          </div>
        </template>
      </div>
    </template>

    <template x-if="!joinedId && !readying && creating">
      <div>
        <form @submit.prevent="submitCustomGame()">
          <label>
            Title
            <input x-model="createForm.title" x-init="$el.focus()" required="true" />
          </label>

          <label>
            Password
            <small>Leave blank for none</small>
            <input x-model="createForm.password" />
          </label>

          <label>
            Time Limit (mins)
            <small>Leave blank for none</small>
            <input x-model="createForm.timeLimit" type="number" />
          </label>

          <label title="Allow other players to watch your game">
            Allow Observers
            <input x-model="createForm.observers.allow" type="checkbox" />
          </label>

          <template x-if="createForm.observers.allow">
            <label>
              See All
              <input x-model="createForm.observers.seeAll" type="checkbox" />
              <small>(hand of cards, etc.)</small>
            </label>
          </template>

          <button type="submit">Submit</button>
          <button type="reset">Reset</button>
          <button type="button" class="attention" @click="cancelCustomGame()">Cancel</button>
        </form>
      </div>
    </template>

    <template x-if="!joinedId && !readying && !creating">
      <div>
        <button
          @click="clickQuickplay()"
          class="success"
          title="Join an open lobby or create a default new lobby"
        >
          Quickplay
        </button>
        <button
          @click="clickCustomGame()"
          class="accent"
          title="Create a custom lobby with configurable options"
        >
          Custom Game
        </button>
        <button
          @click="clickTestGame()"
          class="default"
          title="Play against a passive AI opponent to try out the game and website"
        >
          Test Game vs AI
        </button>
      </div>
    </template>

    <template x-if="!readying">
      <chat-log />
    </template>

    <!-- TTODO Clean up baby's first UI, aka our super roughed out testing one -->
    <!-- TTODO Add game lobby creation settings for "idle rules" - how long a person can idle, and when/if they get kicked (see IDLE_RULES in main.ts) -->
    <!-- TTODO Win/loss screen and proper end of game (show stats, return to lobby, etc.) -->

    <script src="./clientjs/lobby.js"></script>
  </body>
</html>
