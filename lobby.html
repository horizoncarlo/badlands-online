<!DOCTYPE html>
<html lang="en">
  <include-header />
  <body x-data="lobby">
    Player ID: <span x-text="playerId"></span>
    <input x-model="playerName" placeholder="Player Name" />
    <button @click="savePlayerName()">Save</button>

    <!-- TTODO Add create lobby functionality to the lobby.html -->
    <!-- TTODO Also have a "quick play" option that creates a lobby, gives it a generic title and default options, and joins it. So a single press to be in a lobby -->
    <!-- TTODO Lobby chat - should just be a message of type='lobby' and subtype='chat' -->
    <!-- TTODO Clean up baby's first UI, aka our super roughed out testing one -->

    <br />
    Lobbies:
    <ul>
      <template x-for="currentLobby in lobbies">
        <li>
          <span x-text="currentLobby.title"></span>
          Players: <span x-text="currentLobby.players"></span>
          <template x-if="currentLobby.hasPassword && currentLobby.showPasswordEntry">
            <input
              x-init="$el.focus()"
              type="password"
              placeholder="Lobby requires a password"
              x-model="enteredPassword"
              @keyup.enter="clickLobby(currentLobby)"
            />
          </template>
          <button
            @click="clickLobby(currentLobby)"
            :disabled="currentLobby.players.length >= 2"
          >
            <span x-text="isInLobby(currentLobby) ? 'Leave' : 'Join'"></span>
          </button>
        </li>
      </template>
    </ul>

    <template x-if="joinedId && getJoinedLobby()">
      <div class="panel">
        You are in a game lobby for <span x-text="getJoinedLobby().gameId"></span>
        <br />
        Your opponent is <span x-text="getOpponentName()"></span>
        <template x-if="!readying">
          <label style="font-size: 48px">
            <input type="checkbox" @click="markReady($el)">
            I'm Ready
          </label>
        </template>
        <template x-if="readying">
          <div>
            <span x-text="`You will be going ${isFirst ? 'FIRST' : 'SECOND'}`"></span>
            <br />
            <span x-text="`Game starting in ${countdownSeconds}...`"></span>
          </div>
        </template>
      </div>
    </template>

    <!--
      TTODO Lobby system
      - What to do with an idle opponent? Timeout to kick or leave game?
      - Rejoining games on crash? Maybe keep current playerId or hidden key in local storage, then can check if joining a game that had a leaver/crash/timeout?
      - Handle page refresh while an action (such as target mode) is in progress
      - Win/loss screen and proper end of game
  
      Implementation details:
      lobby.html page, server maintains a list (in memory for now, Redis/CouchDB/LowDB eventually) of Games (gameId, title, password, observers, timeLimit) that are rendered into a Lobby List on the page
      1. To start auto-add a plain game and focus on getting joining/gamestate/etc. working
      2. Make "create game" UI
      Can click join to hop into a middle step of a waiting lobby, when both ready there launch to game.html
      For now ignore auto_player and need 2 actual browsers
  
      So existing Websocket approach should "just work" once we tweak the gameId generation and setting
      What WILL be a problem is the gamestate which needs to be brought up another level - also everything in sub-files needs to be moved up, such as actions.undoStack (likely put INSIDE actions like we do with gs.universal)
      -->

    <script src="./clientjs/lobby.js"></script>
  </body>
</html>
