<!DOCTYPE html>
<html lang="en">
  <include-header />
  <body x-data="lobby">
    Player ID: <span x-text="playerId"></span>
    <!-- TTODO Changing name after joining a lobby is a bit jank - name doesn't update, you list your old name as your opponent, etc. -->
    <input x-model="playerName" placeholder="Player Name" />
    <button @click="savePlayerName()">Save</button>

    <!-- TTODO Lobby chat - should just be a message of type='lobby' and subtype='chat' -->
    <!-- TTODO Clean up baby's first UI, aka our super roughed out testing one -->

    <br />
    Lobbies:
    <ul>
      <template x-for="currentLobby in lobbies">
        <li>
          <span x-text="currentLobby.title"></span>
          - Players: <span x-text="currentLobby.players"></span>
          <template x-if="currentLobby.hasPassword && currentLobby.showPasswordEntry">
            <input
              x-init="$el.focus()"
              type="password"
              placeholder="Lobby requires a password"
              x-model="enteredPassword"
              @keyup.enter="clickLobby(currentLobby)"
            />
          </template>
          <template x-if="!readying">
            <button
              @click="clickLobby(currentLobby)"
              :disabled="!isInLobby(currentLobby) && currentLobby.players.length >= 2"
            >
              <span x-text="!isInLobby(currentLobby) ? 'Join' : 'Leave'"></span>
            </button>
          </template>
        </li>
      </template>
    </ul>

    <template x-if="joinedId && getJoinedLobby()">
      <div class="panel">
        You are in a game lobby for <span x-text="getJoinedLobby().gameId"></span>
        <br />
        Your opponent is <span x-text="getOpponentName()"></span>
        <template x-if="!readying">
          <label style="font-size: 48px">
            <input type="checkbox" @click="markReady($el)">
            I'm Ready
          </label>
        </template>
        <template x-if="readying">
          <div>
            <span x-text="`You will be going ${isFirst ? 'FIRST' : 'SECOND'}`"></span>
            <br />
            <span x-text="`Game starting in ${countdownSeconds}...`"></span>
          </div>
        </template>
      </div>
    </template>

    <template x-if="!joinedId && !readying">
      <div>
        <button
          @click="clickQuickplay()"
          class="success"
          title="Join an open lobby or create a default new lobby"
        >
          Quickplay
        </button>
        <button
          @click="clickCustomGame()"
          class="accent"
          title="Create a custom lobby with configurable options"
        >
          Custom Game
        </button>
        <button
          @click="clickTestGame()"
          class="default"
          title="Play against a passive AI opponent to try out the game and website"
        >
          Test Game vs AI
        </button>
      </div>
    </template>

    <!--
      TTODO Lobby system
      - What to do with an idle opponent? Timeout to kick or leave game?
      - Handle page refresh while an action (such as target mode) is in progress
      - Win/loss screen and proper end of game
      -->

    <script src="./clientjs/lobby.js"></script>
  </body>
</html>
