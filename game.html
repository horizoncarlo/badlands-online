<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <base href="/" />
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèú</text></svg>"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@lowlighter/matcha@3.0.0/dist/matcha.min.css" />
    <link rel="stylesheet" href="./css/matcha-override.css" />
    <link rel="stylesheet" href="./css/animation.css" />
    <link rel="stylesheet" href="./css/central.css" />

    <title>Badlands Online</title>

    <script type="text/javascript">
      const CLIENT_WEBSOCKET_ADDRESS = '${CLIENT_WEBSOCKET_ADDRESS}';
      let playerId = '${PLAYER_ID}'; // Replaced server side before returning the page
    </script>

    <script src="./clientjs/utils.js"></script>
    <script src="./clientjs/websocket.js"></script>
    <script src="./sharedjs/websocket-actions.mjs" type="module"></script>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs/dist/cdn.min.js"
    ></script>
  </head>
  <body x-data="gs">
    <section x-data="ui">
      <header>
        <menu>
          <li>
            Debug
            <menu>
              <li>
                Customize Layout
                <menu>
                  <li>Show Chat</li>
                  <li>Show Log</li>
                  <li>Show Timer</li>
                </menu>
              </li>
            </menu>
          </li>
          <li>
            Join As
            <menu>
              <li onclick="action.joinGame('player1')">Be Player 1</li>
              <li onclick="action.joinGame('player2')">Be Player 2</li>
            </menu>
          </li>
        </menu>
      </header>

      <!-- TODO Realistically we wouldn't even GET to this page without being a game (after joining from a lobby), so all these inGame checks will become needless-->
      <template x-if="inGame">
        <div class="draw-pile" title="Draw a card for 2 Water" @mouseover="showWaterCost(2)" @mouseout="hideWaterCost()">
          <img onclick="action.drawCard({ fromWater: true })" src="images/cards/people/punk.png" draggable="false" />
        </div>
      </template>
      <template x-if="playDrawAnimation">
        <img src="images/cards/people/punk.png" class="draw-animation" />
      </template>

      <template x-if="inGame">
        <!-- Note this approach can be used on ANY element to make it repositionable in the page -->
        <div
          draggable="true"
          @dragstart="repositionStart($event)"
          @dragend="repositionEnd($event, $el, [repositionOffsetX, repositionOffsetY])"
          class="water-wrap repositionable"
        >
          <template x-if="getPlayerData().waterCount > 0">
            <template x-for="water in getPlayerData().waterCount">
              <img x-init="waterTokenEles.push($el)" src="images/water.png" class="water-token" draggable="false" />
            </template>
          </template>
          <template x-if="getPlayerData().waterCount <= 0">
            <span>No Water remains</span>
          </template>
        </div>
      </template>

      <div class="slots">
        <template x-for="slot in slots">
          <div
            class="bd-default"
            @dragover.prevent="if (slot.content || !draggingCard) { return false; } $el.classList.add('slot-highlight')"
            @dragleave="$el.classList.remove('slot-highlight')"
            @drop.prevent="$el.classList.remove('slot-highlight'); dropCardInSlot(event, slot)"
          >
            <template x-if="slot.content">
              <img
                draggable="false"
                :alt="slot.content"
                :src="'images/cards/people/' + slot.content.img"
                :class="slot.content.damage >= 1 ? 'damaged-card' : ''"
              />
            </template>
          </div>
        </template>
      </div>

      <footer>
        <template x-if="who">
          <div class="cards">
            <template x-for="card in getMyCards()">
              <div class="card">
                <img
                  :alt="card.img"
                  :src="'images/cards/people/' + card.img"
                  draggable="true"
                  @dragstart="draggingCard = true; $event.dataTransfer.setData('text/plain', card.id);"
                  @dragend="draggingCard = false"
                  @mouseover="showWaterCost(card.cost)"
                  @mouseout="hideWaterCost()"
                  @error="$el.classList.add('card-error')"
                  :title="'Click and drag to play for ' + card.cost + ' Water'"
                />
              </div>
            </template>
          </div>
        </template>
      </footer>
    </section>

    <!-- JS scripts at the bottom like it's 1995 -->
    <script src="./clientjs/badlands.js"></script>
  </body>
</html>
